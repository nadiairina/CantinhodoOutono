<!DOCTYPE html>
<html lang="pt-PT">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mermaid | Biquínis & Fatos de Banho</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://js.stripe.com/v3/"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, deleteDoc, onSnapshot, collection, getDocs, updateDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Substitua ESTES valores pelas suas credenciais reais do Firebase
        const firebaseConfig = {
            apiKey: "SUA_API_KEY",
            authDomain: "SEU_AUTH_DOMAIN",
            projectId: "SEU_PROJECT_ID",
            storageBucket: "SEU_STORAGE_BUCKET",
            messagingSenderId: "SEU_MESSAGING_SENDER_ID",
            appId: "SEU_APP_ID",
        };
        const appId = "SEU_APP_ID";

        let db, auth, userId, cart = [];

        // Função de inicialização do Firebase
        async function initFirebase() {
            try {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);

                // Autenticação do utilizador de forma anónima
                await signInAnonymously(auth);
                
                // Observador para o estado de autenticação
                onAuthStateChanged(auth, user => {
                    if (user) {
                        userId = user.uid;
                        console.log("Utilizador autenticado com ID:", userId);
                        // Inicia a escuta em tempo real do carrinho do utilizador
                        listenToCart();
                    } else {
                        userId = null;
                        console.log("Usuário não autenticado.");
                    }
                });
            } catch (error) {
                console.error("Erro ao inicializar o Firebase:", error);
                showMessageBox("Erro ao conectar com a loja. Tente novamente mais tarde.");
            }
        }
        
        // Chamada da função de inicialização
        initFirebase();

        // Função para escutar as mudanças no carrinho em tempo real
        function listenToCart() {
            if (!userId) {
                console.log("userId não disponível para listenToCart.");
                return;
            }
            const cartCollectionRef = collection(db, `artifacts/${appId}/users/${userId}/cart`);
            onSnapshot(cartCollectionRef, (querySnapshot) => {
                cart = [];
                querySnapshot.forEach((doc) => {
                    cart.push({ id: doc.id, ...doc.data() });
                });
                updateCartDisplay();
            });
        }
    </script>
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #fef9f5;
        }

        .hero-section {
            background-color: #fcd5b4;
        }
        
        .animated-gradient {
            background-size: 400% 400%;
            animation: gradient-animation 10s ease infinite;
        }

        @keyframes gradient-animation {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .btn-primary {
            background-color: #ff914d;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            background-color: #ff7f33;
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .product-card {
            transition: transform 0.3s ease;
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
        }

        .page-content {
            display: none;
        }

        .page-content.active {
            display: block;
        }

        /* Animações de scroll */
        .fade-in {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.6s ease-out, transform 0.6s ease-out;
        }
        
        .fade-in.visible {
            opacity: 1;
            transform: translateY(0);
        }
        
        /* Estilos do Stripe Element */
        #card-element {
            border: 1px solid #e5e7eb;
            padding: 12px;
            border-radius: 8px;
            background-color: #fff;
        }
    </style>
</head>
<body class="bg-[#fef9f5] text-gray-800">

    <header class="bg-white shadow-sm p-4 sticky top-0 z-50">
        <div class="container mx-auto flex justify-between items-center">
            <a href="#" onclick="showPage('home')"><img src="https://placehold.co/120x40/fcd5b4/ff914d?text=O+Seu+Logo" alt="Mermaid - Logotipo da Loja" class="h-10"></a>
            <nav>
                <ul class="flex space-x-6 text-gray-600 font-medium">
                    <li><a href="#" onclick="showPage('home')" class="hover:text-[#ff914d] transition-colors">Início</a></li>
                    <li><a href="#" onclick="showPage('products')" class="hover:text-[#ff914d] transition-colors">Biquínis</a></li>
                    <li><a href="#" onclick="showPage('about')" class="hover:text-[#ff914d] transition-colors">Sobre Nós</a></li>
                    <li><a href="#" onclick="showPage('contact')" class="hover:text-[#ff914d] transition-colors">Contacto</a></li>
                </ul>
            </nav>
            <div class="flex items-center space-x-4">
                <div class="relative">
                    <button onclick="showPage('cart')" class="p-2 rounded-full hover:bg-gray-200 transition-colors relative">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5.4M7 13l-2.293 2.293c-.63.63-.182 1.953.693 1.953H17M17 17a2 2 0 100 4 2 2 0 000-4zm-4 0a2 2 0 100 4 2 2 0 000-4z" />
                        </svg>
                    </button>
                    <span id="cart-count" class="absolute top-0 right-0 inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-red-100 transform translate-x-1/2 -translate-y-1/2 bg-red-600 rounded-full">0</span>
                </div>
            </div>
        </div>
    </header>

    <main class="mt-8 container mx-auto px-4">

        <section id="home" class="page-content active">
            <div class="hero-section text-center py-20 rounded-xl mb-12">
                <h1 class="text-5xl font-extrabold text-[#ff7f33] mb-4 animated-gradient bg-clip-text text-transparent">O teu Verão, o teu estilo</h1>
                <p class="text-xl font-medium text-gray-600 mb-8">Descobre a nossa nova coleção de biquínis e fatos de banho com design exclusivo.</p>
                <a href="#" onclick="showPage('products')" class="btn-primary text-white font-bold py-3 px-8 rounded-full shadow-lg hover:shadow-xl transition-all">Ver Coleção</a>
            </div>

            <h2 class="text-4xl font-bold text-gray-800 mb-8 text-center fade-in">As nossas peças em destaque</h2>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                <div class="bg-white p-6 rounded-xl shadow-md flex flex-col items-center product-card fade-in">
                    <img src="https://placehold.co/400x400/ff914d/ffffff?text=Biquini+1" alt="Biquini de Exemplo" class="w-full rounded-lg mb-4">
                    <h3 class="text-xl font-semibold mb-2">Biquíni Onda</h3>
                    <p class="text-gray-600 mb-4">Top triangulo e cueca de corte alto.</p>
                    <span class="text-2xl font-bold text-[#ff7f33]">€ 49,99</span>
                    <label for="size-1" class="text-sm font-medium text-gray-700 mt-2">Tamanho:</label>
                    <select id="size-1" class="rounded-md border-gray-300 shadow-sm focus:ring focus:ring-indigo-200 focus:ring-opacity-50">
                        <option value="S">S</option>
                        <option value="M">M</option>
                        <option value="L">L</option>
                    </select>
                    <button onclick="addToCart({id: '1', name: 'Biquíni Onda', price: 49.99, image: 'https://placehold.co/400x400/ff914d/ffffff?text=Biquini+1', size: document.getElementById('size-1').value})" class="btn-primary text-white font-bold py-2 px-6 rounded-full mt-4">Adicionar</button>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-md flex flex-col items-center product-card fade-in">
                    <img src="https://placehold.co/400x400/fcd5b4/ffffff?text=Biquini+2" alt="Biquini de Exemplo" class="w-full rounded-lg mb-4">
                    <h3 class="text-xl font-semibold mb-2">Fato de Banho Sol</h3>
                    <p class="text-gray-600 mb-4">Com decote em V e alças ajustáveis.</p>
                    <span class="text-2xl font-bold text-[#ff7f33]">€ 59,99</span>
                    <label for="size-2" class="text-sm font-medium text-gray-700 mt-2">Tamanho:</label>
                    <select id="size-2" class="rounded-md border-gray-300 shadow-sm focus:ring focus:ring-indigo-200 focus:ring-opacity-50">
                        <option value="S">S</option>
                        <option value="M">M</option>
                        <option value="L">L</option>
                    </select>
                    <button onclick="addToCart({id: '2', name: 'Fato de Banho Sol', price: 59.99, image: 'https://placehold.co/400x400/fcd5b4/ffffff?text=Biquini+2', size: document.getElementById('size-2').value})" class="btn-primary text-white font-bold py-2 px-6 rounded-full mt-4">Adicionar</button>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-md flex flex-col items-center product-card fade-in">
                    <img src="https://placehold.co/400x400/ffb88d/ffffff?text=Biquini+3" alt="Biquini de Exemplo" class="w-full rounded-lg mb-4">
                    <h3 class="text-xl font-semibold mb-2">Biquíni Essencial</h3>
                    <p class="text-gray-600 mb-4">Peça clássica com um toque moderno.</p>
                    <span class="text-2xl font-bold text-[#ff7f33]">€ 39,99</span>
                    <label for="size-3" class="text-sm font-medium text-gray-700 mt-2">Tamanho:</label>
                    <select id="size-3" class="rounded-md border-gray-300 shadow-sm focus:ring focus:ring-indigo-200 focus:ring-opacity-50">
                        <option value="S">S</option>
                        <option value="M">M</option>
                        <option value="L">L</option>
                    </select>
                    <button onclick="addToCart({id: '3', name: 'Biquíni Essencial', price: 39.99, image: 'https://placehold.co/400x400/ffb88d/ffffff?text=Biquini+3', size: document.getElementById('size-3').value})" class="btn-primary text-white font-bold py-2 px-6 rounded-full mt-4">Adicionar</button>
                </div>
            </div>
        </section>

        <section id="products" class="page-content">
            <h2 class="text-4xl font-bold text-gray-800 mb-8 text-center">Toda a Coleção</h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8">
                </div>
        </section>

        <section id="cart" class="page-content">
            <h2 class="text-4xl font-bold text-gray-800 mb-8 text-center">O seu Carrinho</h2>
            <p id="loading-message" class="text-center text-gray-500 hidden">A carregar o carrinho...</p>
            <div id="cart-items" class="bg-white rounded-xl shadow-md p-6 mb-6">
                <p id="empty-cart-message" class="text-center text-gray-500">O seu carrinho está vazio.</p>
            </div>
            <div id="cart-summary" class="bg-white rounded-xl shadow-md p-6 text-right">
                <p class="text-xl font-semibold">Total: <span id="cart-total" class="text-[#ff914d]">€ 0,00</span></p>
                <button onclick="showPage('checkout')" class="btn-primary text-white font-bold py-3 px-8 rounded-full mt-4">Finalizar Compra</button>
            </div>
        </section>
        
        <section id="checkout" class="page-content">
            <h2 class="text-4xl font-bold text-gray-800 mb-8 text-center">Finalizar Compra</h2>
            <div id="checkout-items" class="bg-white rounded-xl shadow-md p-6 max-w-2xl mx-auto mb-6">
                </div>
            <form id="checkout-form" class="bg-white rounded-xl shadow-md p-6 max-w-2xl mx-auto">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="name" class="block text-sm font-medium text-gray-700">Nome Completo</label>
                        <input type="text" id="name" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50" required>
                    </div>
                    <div>
                        <label for="email" class="block text-sm font-medium text-gray-700">E-mail</label>
                        <input type="email" id="email" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50" required>
                    </div>
                </div>
                <div class="mt-6">
                    <label for="address" class="block text-sm font-medium text-gray-700">Morada Completa</label>
                    <textarea id="address" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50" required></textarea>
                </div>
                <div class="mt-6">
                    <label for="payment-card" class="block text-sm font-medium text-gray-700">Dados do Cartão</label>
                    <div id="card-element" class="mt-1">
                        </div>
                    <div id="card-errors" role="alert" class="text-red-500 mt-2 text-sm"></div>
                </div>
                <div class="mt-8 text-center">
                    <button type="submit" id="checkout-button" class="btn-primary text-white font-bold py-3 px-8 rounded-full">Pagar e Finalizar</button>
                </div>
            </form>
        </section>

        <section id="about" class="page-content">
            <h2 class="text-4xl font-bold text-gray-800 mb-8 text-center">Sobre a Mermaid</h2>
            <div class="max-w-4xl mx-auto text-center fade-in">
                <p class="text-lg text-gray-600 mb-4">A Mermaid nasceu da paixão pelo verão e pela elegância atemporal. Criamos biquínis e fatos de banho com design exclusivo, focados na qualidade dos materiais e no conforto. Acreditamos que cada mulher deve sentir-se confiante e bonita à beira-mar.</p>
                <p class="text-lg text-gray-600 mb-4">O nosso compromisso é com a sustentabilidade e a produção ética, garantindo que as nossas peças não são apenas bonitas, mas também amigas do ambiente.</p>
                <p class="text-lg text-gray-600 mb-4">Junte-se à nossa comunidade e descubra o seu estilo neste verão!</p>
            </div>
        </section>

        <section id="contact" class="page-content">
            <h2 class="text-4xl font-bold text-gray-800 mb-8 text-center">Contacte-nos</h2>
            <div class="max-w-2xl mx-auto bg-white rounded-xl shadow-md p-6">
                <form id="contact-form">
                    <div class="mb-4">
                        <label for="contact-name" class="block text-sm font-medium text-gray-700">Nome</label>
                        <input type="text" id="contact-name" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50" required>
                    </div>
                    <div class="mb-4">
                        <label for="contact-email" class="block text-sm font-medium text-gray-700">E-mail</label>
                        <input type="email" id="contact-email" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50" required>
                    </div>
                    <div class="mb-4">
                        <label for="contact-message" class="block text-sm font-medium text-gray-700">Mensagem</label>
                        <textarea id="contact-message" rows="4" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50" required></textarea>
                    </div>
                    <div class="text-center">
                        <button type="submit" class="btn-primary text-white font-bold py-3 px-8 rounded-full">Enviar Mensagem</button>
                    </div>
                </form>
            </div>
        </section>

    </main>

    <footer class="bg-[#ff914d] text-white py-8 mt-12">
        <div class="container mx-auto text-center">
            <p>&copy; 2024 Mermaid. Todos os direitos reservados.</p>
        </div>
    </footer>

    <div id="message-box" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white p-6 rounded-lg shadow-xl text-center">
            <p id="message-text" class="text-lg font-semibold mb-4"></p>
            <button onclick="closeMessageBox()" class="btn-primary text-white font-bold py-2 px-6 rounded-full">OK</button>
        </div>
    </div>

    <script>
        const products = [
            { id: '1', name: 'Biquíni Onda', price: 49.99, image: 'https://placehold.co/400x400/ff914d/ffffff?text=Biquini+1', sizes: ['S', 'M', 'L'] },
            { id: '2', name: 'Fato de Banho Sol', price: 59.99, image: 'https://placehold.co/400x400/fcd5b4/ffffff?text=Biquini+2', sizes: ['S', 'M', 'L'] },
            { id: '3', name: 'Biquíni Essencial', price: 39.99, image: 'https://placehold.co/400x400/ffb88d/ffffff?text=Biquini+3', sizes: ['S', 'M', 'L'] },
            { id: '4', name: 'Biquíni Tropical', price: 45.00, image: 'https://placehold.co/400x400/fec88d/ffffff?text=Biquini+4', sizes: ['S', 'M', 'L'] },
            { id: '5', name: 'Fato de Banho Vento', price: 65.00, image: 'https://placehold.co/400x400/ffb8a0/ffffff?text=Biquini+5', sizes: ['S', 'M', 'L'] },
            { id: '6', name: 'Biquíni Elegante', price: 55.00, image: 'https://placehold.co/400x400/ff9880/ffffff?text=Biquini+6', sizes: ['S', 'M', 'L'] },
        ];

        // Animações de scroll
        const faders = document.querySelectorAll('.fade-in');
        const appearOptions = { threshold: 0.5 };
        const appearOnScroll = new IntersectionObserver(function(entries, appearOnScroll) {
            entries.forEach(entry => {
                if (!entry.isIntersecting) {
                    return;
                } else {
                    entry.target.classList.add('visible');
                    appearOnScroll.unobserve(entry.target);
                }
            });
        }, appearOptions);

        faders.forEach(fader => {
            appearOnScroll.observe(fader);
        });

        // Funções do Carrinho de Compras
        async function addToCart(product) {
            if (!userId) {
                console.error("Erro: userId não está definido. A autenticação Firebase pode ter falhado ou ainda não terminou.");
                showMessageBox("Erro: Utilizador não autenticado. A página está a carregar, por favor, tente em alguns segundos.");
                return;
            }

            const docRef = doc(db, `artifacts/${appId}/users/${userId}/cart/${product.id}-${product.size}`);
            const docSnap = await getDoc(docRef);

            if (docSnap.exists()) {
                const currentQuantity = docSnap.data().quantity;
                await updateDoc(docRef, { quantity: currentQuantity + 1 });
            } else {
                await setDoc(docRef, { ...product, quantity: 1, size: product.size });
            }
            showMessageBox(`Produto "${product.name}" (Tamanho: ${product.size}) adicionado ao carrinho!`);
        }

        function updateCartDisplay() {
            const cartItemsContainer = document.getElementById('cart-items');
            const cartTotalSpan = document.getElementById('cart-total');
            const cartCountSpan = document.getElementById('cart-count');
            const emptyMessage = document.getElementById('empty-cart-message');
            
            cartItemsContainer.innerHTML = '';
            let total = 0;

            if (cart.length === 0) {
                emptyMessage.style.display = 'block';
                document.getElementById('cart-summary').style.display = 'none';
            } else {
                emptyMessage.style.display = 'none';
                document.getElementById('cart-summary').style.display = 'block';
                cart.forEach(item => {
                    total += item.price * item.quantity;
                    const itemElement = document.createElement('div');
                    itemElement.classList.add('flex', 'justify-between', 'items-center', 'mb-4', 'pb-4', 'border-b', 'border-gray-200');
                    itemElement.innerHTML = `
                        <div class="flex items-center">
                            <img src="${item.image}" alt="${item.name}" class="w-16 h-16 rounded-lg mr-4">
                            <div>
                                <h4 class="font-semibold">${item.name}</h4>
                                <p class="text-gray-600">€ ${item.price.toFixed(2)}</p>
                                <p class="text-sm text-gray-500">Tamanho: ${item.size}</p>
                            </div>
                        </div>
                        <div class="flex items-center space-x-4">
                            <input type="number" value="${item.quantity}" min="1" onchange="updateQuantity('${item.id}', this.value, '${item.size}')" class="w-16 text-center rounded-md border-gray-300">
                            <button onclick="removeFromCart('${item.id}', '${item.size}')" class="text-red-500 hover:text-red-700 transition-colors">Remover</button>
                        </div>
                    `;
                    cartItemsContainer.appendChild(itemElement);
                });
            }

            cartTotalSpan.textContent = `€ ${total.toFixed(2)}`;
            cartCountSpan.textContent = cart.reduce((sum, item) => sum + item.quantity, 0);
        }

        async function updateQuantity(id, quantity, size) {
            if (!userId) return;
            const newQuantity = parseInt(quantity);
            const docRef = doc(db, `artifacts/${appId}/users/${userId}/cart/${id}-${size}`);
            if (newQuantity <= 0) {
                await deleteDoc(docRef);
            } else {
                await updateDoc(docRef, { quantity: newQuantity });
            }
        }

        async function removeFromCart(id, size) {
            if (!userId) return;
            const docRef = doc(db, `artifacts/${appId}/users/${userId}/cart/${id}-${size}`);
            await deleteDoc(docRef);
        }

        // Funções para a navegação de páginas
        function showPage(pageId) {
            const pages = document.querySelectorAll('.page-content');
            pages.forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(pageId).classList.add('active');

            if (pageId === 'products') {
                renderProducts();
            } else if (pageId === 'cart') {
                // A exibição do carrinho será atualizada automaticamente pelo listener do Firestore
            } else if (pageId === 'checkout') {
                setupStripeCheckout();
            }
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Função para renderizar a página de produtos
        function renderProducts() {
            const productsContainer = document.querySelector('#products .grid');
            productsContainer.innerHTML = '';
            products.forEach(product => {
                const productCard = document.createElement('div');
                productCard.classList.add('bg-white', 'p-6', 'rounded-xl', 'shadow-md', 'flex', 'flex-col', 'items-center', 'product-card');
                
                let sizeOptionsHtml = product.sizes.map(size => `<option value="${size}">${size}</option>`).join('');

                productCard.innerHTML = `
                    <img src="${product.image}" alt="${product.name}" class="w-full rounded-lg mb-4">
                    <h3 class="text-xl font-semibold mb-2">${product.name}</h3>
                    <span class="text-2xl font-bold text-[#ff7f33]">€ ${product.price.toFixed(2)}</span>
                    <label for="size-${product.id}" class="text-sm font-medium text-gray-700 mt-2">Tamanho:</label>
                    <select id="size-${product.id}" class="rounded-md border-gray-300 shadow-sm focus:ring focus:ring-indigo-200 focus:ring-opacity-50">
                        ${sizeOptionsHtml}
                    </select>
                    <button onclick="addToCart({id: '${product.id}', name: '${product.name}', price: ${product.price}, image: '${product.image}', size: document.getElementById('size-${product.id}').value})" class="btn-primary text-white font-bold py-2 px-6 rounded-full mt-4">Adicionar</button>
                `;
                productsContainer.appendChild(productCard);
            });
        }

        // AQUI ESTÁ A LÓGICA DO CHECKOUT COM STRIPE
        let stripe;
        async function setupStripeCheckout() {
            if (!stripe) {
                // SUBSTITUA 'pk_test_SEU_PUBLIC_KEY' pela sua chave pública do Stripe
                stripe = Stripe('pk_test_SEU_PUBLIC_KEY');
            }

            const elements = stripe.elements();
            const cardElement = elements.create('card');
            cardElement.mount('#card-element');

            const checkoutForm = document.getElementById('checkout-form');
            const cardErrors = document.getElementById('card-errors');

            const checkoutItemsContainer = document.getElementById('checkout-items');
            checkoutItemsContainer.innerHTML = '';
            let total = 0;
            cart.forEach(item => {
                total += item.price * item.quantity;
                const itemElement = document.createElement('div');
                itemElement.classList.add('flex', 'justify-between', 'items-center', 'mb-2');
                itemElement.innerHTML = `
                    <p class="text-gray-600">${item.name} (Tamanho: ${item.size}) x ${item.quantity}</p>
                    <p class="font-semibold">€ ${(item.price * item.quantity).toFixed(2)}</p>
                `;
                checkoutItemsContainer.appendChild(itemElement);
            });
            const totalElement = document.createElement('div');
            totalElement.classList.add('flex', 'justify-between', 'items-center', 'font-bold', 'text-lg', 'mt-4', 'pt-4', 'border-t', 'border-gray-200');
            totalElement.innerHTML = `
                <span>Total</span>
                <span class="text-[#ff7f33]">€ ${total.toFixed(2)}</span>
            `;
            checkoutItemsContainer.appendChild(totalElement);

            checkoutForm.addEventListener('submit', async function(event) {
                event.preventDefault();

                if (cart.length === 0) {
                    showMessageBox('O carrinho está vazio. Por favor, adicione produtos antes de finalizar a compra.');
                    return;
                }

                document.getElementById('checkout-button').disabled = true;

                try {
                    const response = await fetch('https://SEU-BACKEND.COM/create-payment-intent', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            items: cart,
                        }),
                    });

                    const { clientSecret } = await response.json();

                    const { error, paymentIntent } = await stripe.confirmCardPayment(clientSecret, {
                        payment_method: {
                            card: cardElement,
                            billing_details: {
                                name: document.getElementById('name').value,
                                email: document.getElementById('email').value,
                            },
                        },
                    });

                    if (error) {
                        cardErrors.textContent = error.message;
                        showMessageBox(`Erro no Pagamento: ${error.message}`);
                    } else if (paymentIntent.status === 'succeeded') {
                        showMessageBox('Obrigado pela sua compra! O seu pagamento foi processado com sucesso. ❤️');
                        
                        if (userId) {
                            const cartCollectionRef = collection(db, `artifacts/${appId}/users/${userId}/cart`);
                            const querySnapshot = await getDocs(cartCollectionRef);
                            querySnapshot.forEach(async (doc) => {
                                await deleteDoc(doc.ref);
                            });
                        }
                        showPage('home');
                    }

                } catch (e) {
                    console.error('Erro na submissão do pagamento:', e);
                    showMessageBox('Ocorreu um erro. Por favor, tente novamente.');
                } finally {
                    document.getElementById('checkout-button').disabled = false;
                }
            });
        }

        // Formulários
        document.getElementById('contact-form').addEventListener('submit', function(e) {
            e.preventDefault();
            showMessageBox('Obrigado! A sua mensagem foi enviada. Entraremos em contacto em breve.');
        });

        // Caixa de Mensagem Customizada (substitui alert())
        function showMessageBox(message) {
            document.getElementById('message-text').textContent = message;
            document.getElementById('message-box').classList.remove('hidden');
        }

        function closeMessageBox() {
            document.getElementById('message-box').classList.add('hidden');
        }

        // Inicialização
        document.addEventListener('DOMContentLoaded', () => {
            showPage('home');
        });
    </script>
</body>
</html>
